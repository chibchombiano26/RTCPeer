<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div>
      <video
        id="local"
        controls
        crossorigin="anonymous"
        muted
        src="https://webrtc.github.io/samples/src/video/chrome.mp4"
      ></video>
      <video id="cloned" autoplay muted></video>
    </div>

    <script type="text/javascript">
      window.onload = () => {
        localStorage.clear();
        const videoElement = document.getElementById("local");
        const stream = videoElement.captureStream();

        let videoElem = document.createElement("video");
        videoElem.autoplay = true;
        videoElem.muted = true;
        videoElem.controls = true;

        const popUpWindow = window.open(
          "popup.html",
          "child",
          "width=500,height=300"
        );
        setTimeout(() => {
          if (!popUpWindow) {
            return;
          }

          const document = popUpWindow.document.getElementById(
            "video-container"
          );
          if (document) {
            document.appendChild(videoElem);
            videoElem.srcObject = stream.clone();
          }
        }, 1000);
      };
    </script>
  </body>
</html>
